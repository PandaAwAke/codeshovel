{
  "origin": "codeshovel",
  "repositoryName": "commons-io",
  "repositoryPath": "/repos/commons-io/.git",
  "startCommitName": "559de2c461e94ab636c959149c775bb27111fb48",
  "sourceFileName": "BOMInputStream.java",
  "functionName": "getBOM",
  "functionId": "getBOM",
  "sourceFilePath": "src/main/java/org/apache/commons/io/input/BOMInputStream.java",
  "functionStartLine": 215,
  "functionEndLine": 242,
  "changeHistory": [
    "e4c65e5424fe7a7c9795348fc855d42a247f0c00",
    "3f8cc6d5f6565608b0146f87137ed34316bc4eb3",
    "83f7246c3e9fe1d3f1ad6cf7ea0715a573fe2f2a",
    "d43262058d2a3530c4d7305ea1a1e03d7001bd1d",
    "ea84049a791cfe83d9fb93e0cdea74dd362b0692"
  ],
  "changeHistoryShort": {
    "e4c65e5424fe7a7c9795348fc855d42a247f0c00": "Ybodychange",
    "3f8cc6d5f6565608b0146f87137ed34316bc4eb3": "Ybodychange",
    "83f7246c3e9fe1d3f1ad6cf7ea0715a573fe2f2a": "Yfilerename",
    "d43262058d2a3530c4d7305ea1a1e03d7001bd1d": "Ybodychange",
    "ea84049a791cfe83d9fb93e0cdea74dd362b0692": "Yintroduced"
  },
  "changeHistoryDetails": {
    "e4c65e5424fe7a7c9795348fc855d42a247f0c00": {
      "type": "Ybodychange",
      "commitMessage": "[IO-320] Add XmlStreamReader support for UTF-32.\n[IO-331] BOMInputStream wrongly detects UTF-32LE_BOM files as UTF-16LE_BOM files in method getBOM().\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1346400 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": 1338907681000,
      "commitName": "e4c65e5424fe7a7c9795348fc855d42a247f0c00",
      "commitAuthor": "Gary D. Gregory",
      "commitDateOld": 1332449729000,
      "commitNameOld": "cf5c462807a137b823a3155dfe9800b3cbf2303d",
      "commitAuthorOld": "Gary D. Gregory",
      "daysBetweenCommits": 74.74,
      "commitsBetweenForRepo": 96,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,26 +1,28 @@\n     public ByteOrderMark getBOM() throws IOException {\n         if (firstBytes \u003d\u003d null) {\n             fbLength \u003d 0;\n-            int max \u003d 0;\n-            for (ByteOrderMark bom : boms) {\n-                max \u003d Math.max(max, bom.length());\n-            }\n-            firstBytes \u003d new int[max];\n+            // BOMs are sorted from longest to shortest\n+            final int maxBomSize \u003d boms.get(0).length();\n+            firstBytes \u003d new int[maxBomSize];\n+            // Read first maxBomSize bytes\n             for (int i \u003d 0; i \u003c firstBytes.length; i++) {\n                 firstBytes[i] \u003d in.read();\n                 fbLength++;\n                 if (firstBytes[i] \u003c 0) {\n                     break;\n                 }\n-\n-                byteOrderMark \u003d find();\n-                if (byteOrderMark !\u003d null) {\n-                    if (!include) {\n+            }\n+            // match BOM in firstBytes\n+            byteOrderMark \u003d find();\n+            if (byteOrderMark !\u003d null) {\n+                if (!include) {\n+                    if (byteOrderMark.length() \u003c firstBytes.length) {\n+                        fbIndex \u003d byteOrderMark.length();\n+                    } else {\n                         fbLength \u003d 0;\n                     }\n-                    break;\n                 }\n             }\n         }\n         return byteOrderMark;\n     }\n\\ No newline at end of file\n",
      "extendedDetails": {}
    },
    "3f8cc6d5f6565608b0146f87137ed34316bc4eb3": {
      "type": "Ybodychange",
      "commitMessage": "[IO-302] ArrayIndexOutOfBoundsException in BOMInputStream when reading a file without BOM multiple times\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1292455 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": 1329938401000,
      "commitName": "3f8cc6d5f6565608b0146f87137ed34316bc4eb3",
      "commitAuthor": "Gary D. Gregory",
      "commitDateOld": 1293059000000,
      "commitNameOld": "dccf793eb78ddc93de1f745f39fb58251fc81ad0",
      "commitAuthorOld": "Niall Pemberton",
      "daysBetweenCommits": 426.84,
      "commitsBetweenForRepo": 119,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,25 +1,26 @@\n     public ByteOrderMark getBOM() throws IOException {\n         if (firstBytes \u003d\u003d null) {\n+            fbLength \u003d 0;\n             int max \u003d 0;\n             for (ByteOrderMark bom : boms) {\n                 max \u003d Math.max(max, bom.length());\n             }\n             firstBytes \u003d new int[max];\n             for (int i \u003d 0; i \u003c firstBytes.length; i++) {\n                 firstBytes[i] \u003d in.read();\n                 fbLength++;\n                 if (firstBytes[i] \u003c 0) {\n                     break;\n                 }\n \n                 byteOrderMark \u003d find();\n                 if (byteOrderMark !\u003d null) {\n                     if (!include) {\n                         fbLength \u003d 0;\n                     }\n                     break;\n                 }\n             }\n         }\n         return byteOrderMark;\n     }\n\\ No newline at end of file\n",
      "extendedDetails": {}
    },
    "83f7246c3e9fe1d3f1ad6cf7ea0715a573fe2f2a": {
      "type": "Yfilerename",
      "commitMessage": "Build changes - re-organize to standard m2 layout, remove useless JIRA report and fix some Ant issues\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1004358 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": 1286218476000,
      "commitName": "83f7246c3e9fe1d3f1ad6cf7ea0715a573fe2f2a",
      "commitAuthor": "Niall Pemberton",
      "commitDateOld": 1286214840000,
      "commitNameOld": "19f48eb1711427a43a5e10c84bbbf1218a08bdd2",
      "commitAuthorOld": "Niall Pemberton",
      "daysBetweenCommits": 0.04,
      "commitsBetweenForRepo": 1,
      "commitsBetweenForFile": 1,
      "diff": "",
      "extendedDetails": {
        "oldPath": "src/java/org/apache/commons/io/input/BOMInputStream.java",
        "newPath": "src/main/java/org/apache/commons/io/input/BOMInputStream.java"
      }
    },
    "d43262058d2a3530c4d7305ea1a1e03d7001bd1d": {
      "type": "Ybodychange",
      "commitMessage": "IO-178 Fix Bug with firstBytes being consumed by getBOM()\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1004087 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": 1286159616000,
      "commitName": "d43262058d2a3530c4d7305ea1a1e03d7001bd1d",
      "commitAuthor": "Niall Pemberton",
      "commitDateOld": 1286149459000,
      "commitNameOld": "ea84049a791cfe83d9fb93e0cdea74dd362b0692",
      "commitAuthorOld": "Niall Pemberton",
      "daysBetweenCommits": 0.12,
      "commitsBetweenForRepo": 4,
      "commitsBetweenForFile": 1,
      "diff": "@@ -1,4 +1,25 @@\n     public ByteOrderMark getBOM() throws IOException {\n-        readFirstBytes();\n+        if (firstBytes \u003d\u003d null) {\n+            int max \u003d 0;\n+            for (ByteOrderMark bom : boms) {\n+                max \u003d Math.max(max, bom.length());\n+            }\n+            firstBytes \u003d new int[max];\n+            for (int i \u003d 0; i \u003c firstBytes.length; i++) {\n+                firstBytes[i] \u003d in.read();\n+                fbLength++;\n+                if (firstBytes[i] \u003c 0) {\n+                    break;\n+                }\n+\n+                byteOrderMark \u003d find();\n+                if (byteOrderMark !\u003d null) {\n+                    if (!include) {\n+                        fbLength \u003d 0;\n+                    }\n+                    break;\n+                }\n+            }\n+        }\n         return byteOrderMark;\n     }\n\\ No newline at end of file\n",
      "extendedDetails": {}
    },
    "ea84049a791cfe83d9fb93e0cdea74dd362b0692": {
      "type": "Yintroduced",
      "commitMessage": "IO-178 Extend BOMInputStream from excluding UTF-8 BOMs to detecting and optionally excluding any BOM\n  - Rename BOMExclusionInputStream to BOMInputStream\n  - Add new ByteOrderMark implementation\n  - Enhance BOMInputStream from only processing UTF-8 BOMs to be able to configure for any BOM\n  - Provide ability to get/check the BOM detected\n  - Provide facility to either include or exclude the detected BOM\n\n\ngit-svn-id: https://svn.apache.org/repos/asf/commons/proper/io/trunk@1004073 13f79535-47bb-0310-9956-ffa450edef68\n",
      "commitDate": 1286149459000,
      "commitName": "ea84049a791cfe83d9fb93e0cdea74dd362b0692",
      "commitAuthor": "Niall Pemberton"
    }
  }
}